#!/usr/local/bin/python

import mysql.connector

mydb = mysql.connector.connect(
  host="localhost",
  user="db_user",
  passwd="db_pass",
  database="database"
)

mycursor = mydb.cursor(buffered=True)

# The signaure of the malware: '0x112012'
mycursor.execute("SELECT id, post_content FROM wp_posts WHERE post_content LIKE '%0x112012%'")

row = mycursor.fetchone()

while row is not None:

  # There is no other js script starting with the same string
    xx = row[1].encode('utf-8', 'ignore').split("<script>var")

    mycursor2 = mydb.cursor(buffered=True)

    idata = (row[0],)

    print(row[0])

    mycursor2.execute("SELECT id, post_content FROM wp_posts WHERE ID = %s", idata)

    sql = "UPDATE wp_posts SET post_content = %s WHERE id = %s"
    inputdata = (xx[0], row[0])
    mycursor2.execute(sql, inputdata)
    mydb.commit()

    row = mycursor.fetchone()

mycursor.close()
mycursor2.close()
mydb.close()

